name: Compilar Cheat Engine para Windows

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]
  workflow_dispatch:

jobs:
  build:
    runs-on: windows-latest

    steps:
    - name: Clonar el repositorio de Cheat Engine
      uses: actions/checkout@v3
      with:
        repository: cheat-engine/cheat-engine
        submodules: 'recursive'

    - name: Instalar Lazarus IDE
      shell: powershell
      run: |
        echo "Descargando Lazarus IDE..."
        Invoke-WebRequest -Uri "https://sourceforge.net/projects/lazarus/files/Lazarus%20Windows%2064%20bits/Lazarus%202.2.2/lazarus-2.2.2-fpc-3.2.2-win64.exe/download" -OutFile "lazarus_installer.exe"
        echo "Instalando Lazarus IDE silenciosamente..."
        Start-Process -FilePath ".\lazarus_installer.exe" -ArgumentList "/VERYSILENT /NORESTART /DIR=C:\lazarus" -Wait
        echo "Lazarus IDE instalado en C:\lazarus"
        echo "Agregando Lazarus al PATH..."
        echo "C:\lazarus" | Out-File -FilePath $env:GITHUB_PATH -Encoding utf8 -Append

    - name: Compilar Cheat Engine
      shell: cmd
      run: |
        echo "Compilando Cheat Engine..."
        lazbuild --build-all "Cheat Engine/cheatengine.lpi"

    - name: Subir artefacto de compilaci√≥n
      uses: actions/upload-artifact@v3
      with:
        name: CheatEngine-Windows
        path: |
          Cheat Engine/bin/
          Cheat Engine/bin64/
